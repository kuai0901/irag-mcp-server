# 功能演示指南

本文档展示百度iRAG MCP服务器的完整功能，包括新增的图片保存功能。

## 🎯 核心功能概览

### 1. 图片生成 + Base64显示
- 调用百度iRAG API生成图片
- 自动下载并转换为base64格式
- 在MCP客户端中直接显示图片

### 2. 本地文件保存 ⭐ 新功能
- 自动保存图片到本地文件系统
- 提供清晰的文件路径信息
- 支持自定义保存目录
- 智能文件命名（时间戳+序号）

### 3. 灵活的资源模式
- **local模式**: 同时提供base64显示和本地文件
- **url模式**: 仅提供base64显示，不保存文件

### 4. 可配置的默认模型 ⭐ 新功能
- 通过`MODEL`环境变量设置默认使用的模型
- 支持`irag-1.0`（快速）和`flux.1-schnell`（高质量）
- 用户请求中仍可覆盖默认模型

## 🚀 功能演示

### 演示1：基础图片生成

**用户输入：**
```
请生成一张可爱小猫的图片
```

**系统响应：**
```
图片 1 生成成功
📁 已保存到: C:\Users\YourName\Desktop\irag-images\irag-2025-06-30-16-30-45-123-1.png

[显示生成的图片]
```

**结果：**
- ✅ 在Claude Desktop中看到图片
- ✅ 在桌面irag-images文件夹中找到PNG文件
- ✅ 文件可以用任何图片查看器打开

### 演示2：批量生成

**用户输入：**
```
请生成3张不同风格的风景画
```

**系统响应：**
```
图片 1 生成成功
📁 已保存到: C:\Users\YourName\Desktop\irag-images\irag-2025-06-30-16-31-20-456-1.png

图片 2 生成成功
📁 已保存到: C:\Users\YourName\Desktop\irag-images\irag-2025-06-30-16-31-25-789-2.png

图片 3 生成成功
📁 已保存到: C:\Users\YourName\Desktop\irag-images\irag-2025-06-30-16-31-30-012-3.png

[显示3张生成的图片]
```

### 演示3：默认模型配置

**配置设置：**
```env
MODEL=flux.1-schnell
```

**用户输入：**
```
请生成一张科幻城市图
```

**系统响应：**
```
图片 1 生成成功
📁 已保存到: C:\Users\YourName\Desktop\irag-images\irag-2025-06-30-16-32-15-345-1.png

[显示使用flux.1-schnell模型生成的高质量图片]
```

**说明**: 由于配置了默认模型为flux.1-schnell，即使用户没有指定模型，也会使用高质量模型生成。

### 演示4：高级参数控制

**用户输入：**
```
请使用flux.1-schnell模型生成一张2048x1152的科幻城市图，采样步数20，随机种子12345
```

**系统响应：**
```
图片 1 生成成功
📁 已保存到: C:\Users\YourName\Desktop\irag-images\irag-2025-06-30-16-33-20-678-1.png

[显示高分辨率科幻城市图片]
```

## 📁 文件管理功能

### 自动目录创建
- 首次使用时自动创建保存目录
- 默认路径：`用户桌面/irag-images`
- 支持自定义路径配置

### 智能文件命名
- 格式：`irag-{时间戳}-{序号}.png`
- 时间戳：`YYYY-MM-DD-HH-mm-ss-SSS`
- 序号：同一次请求中的图片编号
- 示例：`irag-2025-06-30-16-30-45-123-1.png`

### 文件统计信息
服务器内部维护图片统计：
- 总图片数量
- 总文件大小
- 最新/最旧图片信息

## ⚙️ 配置选项

### 环境变量配置

```env
# 图片资源模式
RESOURCE_MODE=local          # local | url

# 自定义保存路径（可选）
BASE_PATH=C:\MyImages        # Windows
BASE_PATH=/home/user/images  # Linux
BASE_PATH=/Users/user/Images # macOS

# 默认模型配置
MODEL=irag-1.0              # irag-1.0 | flux.1-schnell
```

### 配置效果对比

| 配置 | Base64显示 | 本地文件 | 路径信息 | 默认模型 | 适用场景 |
|------|------------|----------|----------|----------|----------|
| `RESOURCE_MODE=local, MODEL=irag-1.0` | ✅ | ✅ | ✅ | 快速 | 推荐，日常使用 |
| `RESOURCE_MODE=local, MODEL=flux.1-schnell` | ✅ | ✅ | ✅ | 高质量 | 专业创作 |
| `RESOURCE_MODE=url` | ✅ | ❌ | ❌ | 配置决定 | 临时使用 |

## 🔧 测试和验证

### 1. 功能测试
```bash
# 测试图片保存功能
npm run test:images

# 测试真实API调用
npm run test:api
```

### 2. 验证步骤
1. **配置验证**: 检查.env文件设置
2. **API测试**: 验证百度API连接
3. **保存测试**: 确认文件正确保存
4. **显示测试**: 验证base64正确显示
5. **路径测试**: 确认路径信息准确

### 3. 成功标志
- ✅ Claude Desktop中显示图片
- ✅ 本地文件夹中有PNG文件
- ✅ 文件大小合理（通常10-100KB）
- ✅ 文件可以正常打开查看
- ✅ 路径信息准确无误

## 🎨 使用技巧

### 1. 提示词优化
```
# 基础提示词
请生成一张小猫的图片

# 优化后的提示词
请生成一张可爱的橘色长毛猫，坐在阳光明媚的窗台上，背景是模糊的花园景色，温暖的光线，高清摄影风格
```

### 2. 参数组合
```
# 快速生成（小尺寸）
请生成一张512x512的概念图

# 高质量生成（大尺寸）
请生成一张2048x2048的高清壁纸

# 批量生成
请生成4张不同角度的产品设计图
```

### 3. 文件管理
- 定期清理旧图片文件
- 使用有意义的BASE_PATH路径
- 按项目分类保存图片

## 🚨 注意事项

### 1. 存储空间
- 每张图片通常10-100KB
- 大尺寸图片可能达到几MB
- 定期清理不需要的图片

### 2. 网络要求
- 需要稳定的网络连接
- 图片下载可能需要几秒钟
- 网络问题会影响保存功能

### 3. 权限要求
- 确保有写入目标目录的权限
- Windows可能需要管理员权限
- 检查防病毒软件设置

## 🔮 未来扩展

### 计划中的功能
1. **图片格式支持**: 支持JPEG、WebP等格式
2. **批量管理**: 图片分类和标签功能
3. **云存储集成**: 支持上传到云存储服务
4. **图片编辑**: 基础的图片处理功能
5. **历史记录**: 生成历史和搜索功能

### 扩展建议
- 集成图片压缩功能
- 添加水印和版权信息
- 支持自定义文件命名规则
- 实现图片去重功能

## 📞 获取帮助

如果遇到问题：
1. 查看 [TROUBLESHOOTING.md](TROUBLESHOOTING.md)
2. 运行 `npm run test:images` 诊断问题
3. 检查文件权限和磁盘空间
4. 确认网络连接正常

---

**恭喜！** 您现在拥有了一个功能完整的图片生成和保存系统。享受AI图片创作的乐趣吧！ 🎨✨
